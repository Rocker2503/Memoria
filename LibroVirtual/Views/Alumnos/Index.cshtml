@model IEnumerable<LibroVirtual.Models.Alumno>

@{
    ViewData["Title"] = "Index";
    var IdUrl = ViewContext.RouteData.Values["id"];
    int id = Convert.ToInt32(IdUrl);
}

<h2>Nómina de Alumnos</h2>

<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.ApellidoPaterno)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ApellidoMaterno)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Nombres)
            </th>
            <th>
                <a asp-action="Create" asp-route-id="@id" class="btn btn-info">Agregar Alumno</a>
            </th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model) {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.ApellidoPaterno)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.ApellidoMaterno)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Nombres)
            </td>
            <td>
                <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-primary">Ver Info</a>
                <a data-toggle="modal" data-target="#myModal" class="btn btn-success" onclick="getDataAjax('@item.Id')">Editar</a>
                <a data-toggle="modal" data-target="#myModal2" class="btn btn-danger" onclick="getDataAjax('@item.Id')">Eliminar</a>
            </td>
        </tr>
}
    </tbody>
</table>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Editar Alumno</h4>
            </div>
            <div class="modal-body">
                <form asp-action="Edit">
                    <div class="form-horizontal">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                        <input type="hidden" name="Id" id="Id" for="Id" />
                        <input type="hidden" name="RefCurso" for="RefCurso"/>
                        <input type="hidden" name="Sexo" for="Sexo"/>
                        <div class="form-group">
                            <div class="col-md-10">
                                <label for="ApellidoPaterno" class="control-label">Apellido Paterno</label>
                                <input type="text" name="ApellidoPaterno" id="ApellidoPaterno" class="form-control"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-10">
                                <label for="ApellidoMaterno" class="control-label">Apellido Materno</label>
                                <input type="text" name="ApellidoMaterno" id="ApellidoMaterno" class="form-control"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-10">
                                <label for="Nombres" class="control-label">Nombres</label>
                                <input type="text" name="Nombres" id="Nombre" class="form-control"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-10">
                                <label for="FechaNacimiento" class="control-label">Fecha de Nacimiento</label>
                                <input type="date" name="FechaNacimiento" id="FechaNacimiento" class="form-control"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-10">
                                <label for="Direccion" class="control-label">Dirección</label>
                                <input type="text" name="Direccion" id="Direccion" class="form-control"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-10">
                                <label for="Comuna" class="control-label">Comuna</label>
                                <input type="text" name="Comuna" id="Comuna" class="form-control"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-10">
                                <label for="Procedencia" class="control-label">Procedencia</label>
                                <input type="text" name="Procedencia" id="Procedencia" class="form-control"/>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" onclick="setDataUser()" class="btn btn-primary">Guardar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="myModal2" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">Eliminar Curso</h4>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <h4 id="parrafo5"></h4>
                    </div>
                </div>
                <input type="hidden" name="Id" id="Id" />
                <p>¿Está seguro de eliminar este Alumno?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" onclick="eliminarAlumno()" class="btn btn-danger">Eliminar</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    $('#myModal').on('shown.bs.modal', function () {
    })

    $('#myModal2').on('shown.bs.modal', function () {
     })

    var items;

    function getDataAjax(id) {
        var url = window.location.origin + '/Alumnos/EditAjax';
        $.ajax({
            type: "POST",
            data: { id },
            url: url,
            success: function (response) {
                console.log(response);
                onSuccess(response);
            }
        });
    }

    function onSuccess(response) {
        items = response;
        $.each(items, function (items, val) {
            $('input[name=Id]').val(val.id);
            $('input[name=ApellidoPaterno]').val(val.apellidoPaterno);
            $('input[name=ApellidoMaterno]').val(val.apellidoMaterno);
            $('input[name=Nombres]').val(val.nombres);
            $('input[name=Sexo]').val(val.sexo);
            $('input[name=FechaNacimiento]').val(val.fechaNacimiento);
            $('input[name=Direccion]').val(val.direccion);
            $('input[name=Comuna]').val(val.comuna);
            $('input[name=Procedencia]').val(val.procedencia);
            $('input[name=RefCurso]').val(val.refCurso);
        });
        $.each(items, function (items, val) {
            $("#parrafo5").text(val.nombres);
            $("input[name=Id]").val(val.id);
        });
    }

    function setDataUser() {
        var id = $('input[name=Id]')[0].value;
        var apellidoPaterno = $('input[name=ApellidoPaterno]')[0].value;
        var apellidoMaterno = $('input[name=ApellidoMaterno]')[0].value;
        var nombres = $('input[name=Nombres]')[0].value;
        var sexo = $('input[name=Sexo]')[0].value;
        var fechaNacimiento = $('input[name=FechaNacimiento]')[0].value;
        var direccion = $('input[name=Direccion]')[0].value;
        var comuna = $('input[name=Comuna]')[0].value;
        var procedencia = $('input[name=Procedencia]')[0].value;
        var refCurso = $('input[name=RefCurso]')[0].value;

        console.log(id);

        if (apellidoPaterno == "") {
            $('#ApellidoPaterno').focus();
            alert("Ingrese el Apellido Paterno");
        }
        if (apellidoMaterno == "") {
            $('#ApellidoMaterno').focus();
            alert("Ingrese el Apellido Materno");
        }
        if (nombres == "") {
            $('#Nombres').focus();
            alert("Ingrese Nombres");
        }
        if (fechaNacimiento == "") {
            $('#FechaNacimiento').focus();
            alert("Ingrese Fecha de Nacimiento");
        }
        if (direccion == "") {
            $('#Direccion').focus();
            alert("Ingresa una Dirección");
        }
        if (comuna == "") {
            $('#Comuna').focus();
            alert("Ingrese una Comuna");
        }
        if (procedencia == "") {
            $('#Procedencia').focus();
            alert("Ingrese Colegio de procedencia");
        }
        var url = window.location.origin + '/Alumnos/EditAlumnoAjax';
        console.log(url);

        $.ajax({
            type: "POST",
            url: url,
            data: { id, apellidoPaterno, apellidoMaterno, nombres, sexo, fechaNacimiento, direccion, comuna, procedencia, refCurso },
            success: function (response) {
                if (response = "Save") {
                    window.location.replace(window.location.href);
                }
            }
        });
    }

    function eliminarAlumno() {
        var url = window.location.origin + '/Alumnos/EliminarAlumno';
        var id = $('input[name=Id]')[0].value;
        $.ajax({
            type: "POST",
            url: url,
            data: { id },
            success: function (response) {
                if (response = "Delete") {
                    window.location.replace(window.location.href);
                }
            }
        });
    }


</script>